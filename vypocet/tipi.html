<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8" />
    <title>Půlkruh z pruhů látky</title>
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 20px;
            background: #f7f7fa;
            color: #222;
        }

        h1 {
            font-size: 1.4rem;
            margin-bottom: 0.5rem;
        }

        h2 {
            margin-top: 2rem;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: flex-end;
            margin-bottom: 1rem;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            background: #ffffff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
        }

        .field {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            font-size: 0.9rem;
        }

        .field input {
            padding: 0.3rem 0.5rem;
            border-radius: 6px;
            border: 1px solid #ccc;
            min-width: 90px;
        }

        button {
            padding: 0.4rem 0.9rem;
            border-radius: 999px;
            border: none;
            background: #4a6cf7;
            color: white;
            cursor: pointer;
            font-weight: 600;
        }

        button:hover {
            background: #3b59cf;
        }

        #canvasWrapper {
            background: #ffffff;
            padding: 0.75rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
            margin-bottom: 1rem;
        }

        canvas {
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fcfcff;
        }

        table {
            border-collapse: collapse;
            margin-top: 0.5rem;
            background: #ffffff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
            width: 100%;
        }

        #cutTableContainer {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            max-width: 100%;
        }

        #cutTableContainer .collapse-content {
            width: auto;
        }

        #cutTableContainer table {
            width: 100px;
            max-width: 100%;
        }

        th,
        td {
            padding: 0.4rem 0.7rem;
            border-bottom: 1px solid #eee;
            font-size: 0.9rem;
            text-align: right;
        }

        th:first-child,
        td:first-child {
            text-align: left;
        }

        th {
            background: #f0f2ff;
            font-weight: 600;
        }

        tr:last-child td {
            border-bottom: none;
        }

        #error {
            color: #c0392b;
            margin-top: 0.4rem;
            font-size: 0.85rem;
        }

        .collapsible {
            cursor: pointer;
            background: #dfe6ff;
            padding: 0.6rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .burger {
            font-size: 1.2rem;
        }

        .collapse-content {
            display: none;
        }

        .collapse-content.open {
            display: block;
        }

        .row {
            display: flex;
            gap: 2rem;
            align-items: flex-start;
        }

        .left {
            flex: 0 0 60%;
        }

        .right {
            flex: 1;
            background: #ffffff;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
            font-size: 1.1rem;
            font-weight: 600;
        }
    </style>
</head>

<body>
    <h1>Půlkruh z vodorovných pruhů látky</h1>

    <div class="controls">
        <div class="field">
            <label for="radius">Poloměr R (cm)</label>
            <input id="radius" type="number" min="1" value="600" step="1">
        </div>

        <div class="field">
            <label for="stripHeight">Šířka pruhu (cm)</label>
            <input id="stripHeight" type="number" min="1" value="145" step="1">
        </div>

        <div class="field">
            <label for="loopWidth">Šířka poutka (cm)</label>
            <input id="loopWidth" type="number" min="1" value="5" step="1">
        </div>

        <button id="updateBtn">Přepočítat &amp; překreslit</button>
        <div id="error"></div>
    </div>

    <div id="canvasWrapper">
        <canvas id="plot" width="800" height="500"></canvas>
    </div>

    <h2>Délky pruhů</h2>

    <div class="row">
        <div class="left">
            <div id="tableContainer"></div>
        </div>

        <div class="right">

            <div style="display:flex; align-items:center; gap:2rem; margin-bottom:1rem;">
                <div>
                    Počet poutek (po 50 cm):<br>
                    <span id="loopCount" style="font-size:2rem;">0</span>
                </div>

                <div>
                    Jehlice (jedna strana):<br>
                    <span id="needleCount" style="font-size:2rem; color:#000;">0</span>
                </div>
            </div>

            <div>Chlopně délka:
                <span id="rectA" style="color:#4a6cf7"></span> cm
            </div>

            <div>Chlopně šířka:
                <span id="rectB" style="color:#4a6cf7"></span> cm
            </div>

            <div>Klín – výška:
                <span id="klinH" style="color:#4a6cf7"></span> cm
            </div>

            <div>Klín – délka nástřihu:
                <span id="klinL" style="color:#4a6cf7"></span> cm
            </div>

        </div>

    </div>


    <h2>Odstřihy podle pruhů</h2>
    <div id="cutTableContainer"></div>
    <script>
        const canvas = document.getElementById('plot');
        const ctx = canvas.getContext('2d');

        const radiusInput = document.getElementById('radius');
        const stripInput = document.getElementById('stripHeight');

        const rectASpan = document.getElementById('rectA');
        const rectBSpan = document.getElementById('rectB');
        const needleCountSpan = document.getElementById('needleCount');
        const klinHSpan = document.getElementById('klinH');
        const klinLSpan = document.getElementById('klinL');

        const errorEl = document.getElementById('error');
        const tableContainer = document.getElementById('tableContainer');
        const cutTableContainer = document.getElementById('cutTableContainer');

        /* -------------------------
           TABULKA A/B podle R/100
        -------------------------- */
        const rectTable = [
            { d: 3.0, A: 150, B: 40 },
            { d: 4.0, A: 160, B: 45 },
            { d: 4.8, A: 210, B: 45 },
            { d: 5.3, A: 230, B: 50 },
            { d: 6.0, A: 260, B: 50 },
            { d: 6.3, A: 260, B: 50 },
            { d: 7.0, A: 270, B: 55 },
            { d: 7.7, A: 270, B: 55 }
        ];

        function findRectByDiameter(d) {
            let best = rectTable[0];
            let diff = Math.abs(d - best.d);

            rectTable.forEach(r => {
                const newDiff = Math.abs(d - r.d);
                if (newDiff < diff) {
                    diff = newDiff;
                    best = r;
                }
            });

            return best;
        }

        /* -------------------------
           TABULKA KLÍNŮ
        -------------------------- */
        const wedgeTable = [
            { r: 3.0, h: 60, l: 60 },
            { r: 4.0, h: 80, l: 80 },
            { r: 6.3, h: 90, l: 80 },
            { r: 7.0, h: 90, l: 90 },
            { r: 7.7, h: 100, l: 90 }
        ];

        function findWedgeByRadius(rMeters) {
            let best = wedgeTable[0];
            let diff = Math.abs(rMeters - best.r);

            wedgeTable.forEach(w => {
                const newDiff = Math.abs(rMeters - w.r);
                if (newDiff < diff) {
                    diff = newDiff;
                    best = w;
                }
            });

            return best;
        }

        /* -------------------------
           odstřih výpočet
        -------------------------- */
        function horizontalCut(R, yStrip, t) {
            const y = yStrip + t;
            if (y >= R) return 0;

            const xCurve = Math.sqrt(R * R - y * y);
            const xStrip = Math.sqrt(R * R - yStrip * yStrip);

            return xStrip - xCurve;
        }

        function generateCutTable(strips, R, step = 10) {
            const colors = ["#ffe6e6", "#e6f0ff", "#f3e6ff", "#e6ffe6", "#f2f2f2", "#fff2e6"];
            let html = "";

            strips.forEach((sh, idx) => {
                const stripNumber = idx + 1;
                const color = colors[idx % colors.length];
                const yStrip = sh.yBottom;
                const height = sh.yTop - sh.yBottom;

                html += `
                    <div class="collapsible">Pruh ${stripNumber} <span class="burger">☰</span></div>
                    <div class="collapse-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>Výška (cm)</th>
                                    <th>Odstřih (cm)</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                for (let t = 0; t <= height; t += step) {
                    const cut = horizontalCut(R, yStrip, t);
                    html += `
                        <tr style="background:${color}">
                            <td>${t}</td>
                            <td>${cut.toFixed(2)}</td>
                        </tr>`;
                }

                if (height % step !== 0) {
                    const cut = horizontalCut(R, yStrip, height);
                    html += `
                        <tr style="background:${color}">
                            <td>${height}</td>
                            <td>${cut.toFixed(2)}</td>
                        </tr>`;
                }

                html += `
                            </tbody>
                        </table>
                    </div>`;
            });

            return html;
        }

        /* -------------------------
           KRESLENÍ
        -------------------------- */
        function draw() {
            const R = parseFloat(radiusInput.value);
            const a = parseFloat(stripInput.value);

            errorEl.textContent = "";

            if (isNaN(R) || isNaN(a) || R <= 0 || a <= 0) {
                errorEl.textContent = "Zadej kladné hodnoty.";
                return;
            }

            if (a > R) {
                errorEl.textContent = "Šířka pruhu je větší než poloměr.";
                return;
            }

            /* ---- počet poutek ---- */
            const halfCircumference = Math.PI * R;
            const loopCount = Math.floor(halfCircumference / 50);
            document.getElementById('loopCount').textContent = loopCount;

            /* ---- výběr A/B ---- */
            const rMeters = R / 100;
            const rect = findRectByDiameter(rMeters);
            const A = rect.A;
            const B = rect.B;

            rectASpan.textContent = A;
            rectBSpan.textContent = B;

            /* ---- výběr klínu podle R ---- */
            const wedge = findWedgeByRadius(rMeters);
            klinHSpan.textContent = wedge.h;
            klinLSpan.textContent = wedge.l;

            /* ---- mezera (R - A) ---- */
            let gap = R - A;


            /* -----------------------------------
               JEHLE – PRAVÁ I LEVÁ STRANA
               první 10 cm, další po 25 cm
            ----------------------------------- */
            let needleCount = 0;
            let needlePositionsRight = [];
            let needlePositionsLeft = [];

            if (gap >= 10) {
                let x = A + 10;
                needleCount = 1;
                needlePositionsRight.push(x);

                while (x + 25 < R) {
                    x += 25;
                    needlePositionsRight.push(x);
                    needleCount++;
                }

                needlePositionsLeft = needlePositionsRight.map(v => -v);
            }

            needleCountSpan.textContent = needleCount;
            /* ---- pruhy ---- */
            const fullStrips = Math.floor(R / a);
            const remainder = R - fullStrips * a;
            const stripHeights = [];
            let y = 0;

            for (let i = 0; i < fullStrips; i++) {
                stripHeights.push({ yBottom: y, yTop: y + a });
                y += a;
            }
            if (remainder > 0.0001) {
                stripHeights.push({ yBottom: y, yTop: R });
            }

            const lengths = [];
            stripHeights.forEach((sh, idx) => {
                if (idx === 0) {
                    lengths.push({ index: 1, yTop: sh.yTop, length: 2 * R });
                } else {
                    const yPrevTop = stripHeights[idx - 1].yTop;
                    const len = 2 * Math.sqrt(Math.max(0, R * R - yPrevTop * yPrevTop));
                    lengths.push({ index: idx + 1, yTop: sh.yTop, length: len });
                }
            });

            /* ---- canvas ---- */
            const margin = 40;
            const w = canvas.width;
            const h = canvas.height;
            ctx.clearRect(0, 0, w, h);

            const scale = Math.min(
                (w - 2 * margin) / (2 * R),
                (h - 2 * margin) / R
            );

            const toScreenX = x => w / 2 + x * scale;
            const toScreenY = yVal => h - margin - yVal * scale;

            ctx.fillStyle = "#fcfcff";
            ctx.fillRect(0, 0, w, h);

            /* ---- půlkruh ---- */
            ctx.strokeStyle = "#f39c12";
            ctx.lineWidth = 2.5;
            ctx.beginPath();
            for (let t = 0; t <= Math.PI; t += Math.PI / 180) {
                const x = R * Math.cos(t);
                const yVal = R * Math.sin(t);
                const sx = toScreenX(x);
                const sy = toScreenY(yVal);
                if (t === 0) ctx.moveTo(sx, sy);
                else ctx.lineTo(sx, sy);
            }
            ctx.stroke();

            /* ---- pruhy ---- */
            const colors = ["#e74c3c", "#2980b9", "#9b59b6", "#27ae60", "#7f8c8d", "#e67e22"];
            const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

            stripHeights.forEach((sh, idx) => {
                const color = colors[idx % colors.length];
                const lengthObj = lengths[idx];
                const L = lengthObj.length;
                const yBottom = sh.yBottom;
                const yTop = sh.yTop;

                const xLeft = -L / 2;
                const xRight = L / 2;

                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.strokeRect(
                    toScreenX(xLeft),
                    toScreenY(yTop),
                    (xRight - xLeft) * scale,
                    (yTop - yBottom) * scale
                );

                if (yTop < R - 1e-6) {
                    const xInt = Math.sqrt(Math.max(0, R * R - yTop * yTop));
                    const sx1 = toScreenX(xInt);
                    const sx2 = toScreenX(-xInt);
                    const sy = toScreenY(yTop);

                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.arc(sx1, sy, 4, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(sx2, sy, 4, 0, 2 * Math.PI);
                    ctx.fill();

                    ctx.font = "12px system-ui";
                    ctx.fillText(letters[idx], sx1 + 8, sy - 4);
                    ctx.fillText(letters[idx], sx2 - 14, sy - 4);
                }
            });

            /* -------------------------
               OBDÉLNÍKY KOLEM BODU X
            -------------------------- */
            ctx.save();
            ctx.strokeStyle = "black";
            ctx.setLineDash([6, 4]);
            ctx.lineWidth = 2;

            // levý obdélník: od -A do 0
            ctx.strokeRect(
                toScreenX(-A),
                toScreenY(B),
                A * scale,
                B * scale
            );

            // pravý obdélník: od 0 do +A
            ctx.strokeRect(
                toScreenX(0),
                toScreenY(B),
                A * scale,
                B * scale
            );

            ctx.restore();

            /* ---- bod X ---- */
            const sx0 = toScreenX(0);
            const sy0 = toScreenY(0);
            ctx.fillStyle = "black";
            ctx.beginPath();
            ctx.arc(sx0, sy0, 4, 0, 2 * Math.PI);
            ctx.fill();
            ctx.fillText("X", sx0 + 6, sy0 - 6);

            /* -------------------------
               KRESLENÍ JEHLIC
            -------------------------- */
            ctx.fillStyle = "#000";

            // pravá strana
            needlePositionsRight.forEach(x => {
                ctx.beginPath();
                ctx.arc(toScreenX(x), toScreenY(B), 4, 0, 2 * Math.PI);
                ctx.fill();
            });

            // levá strana
            needlePositionsLeft.forEach(x => {
                ctx.beginPath();
                ctx.arc(toScreenX(x), toScreenY(B), 4, 0, 2 * Math.PI);
                ctx.fill();
            });

            /* ---- tabulka délek ---- */
            let html = "<table><thead><tr><th>Pruh</th><th>Horní výška y (cm)</th><th>Délka horní hrany (cm)</th></tr></thead><tbody>";
            lengths.forEach(obj => {
                html += `<tr>
                <td>${obj.index}</td>
                <td>${obj.yTop.toFixed(2)}</td>
                <td>${obj.length.toFixed(2)}</td>
            </tr>`;
            });
            html += "</tbody></table>";
            tableContainer.innerHTML = html;

            /* ---- odstřihy ---- */
            const cutHTML = generateCutTable(stripHeights, R, 10);
            cutTableContainer.innerHTML = cutHTML;
        }

        /* --- eventy --- */
        document.getElementById('updateBtn').addEventListener('click', draw);
        radiusInput.addEventListener('change', draw);
        stripInput.addEventListener('change', draw);

        document.addEventListener("click", e => {
            const header =
                e.target.classList.contains("collapsible") ? e.target :
                    e.target.parentElement?.classList.contains("collapsible") ? e.target.parentElement :
                        null;

            if (!header) return;

            header.nextElementSibling.classList.toggle("open");
        });

        draw();
    </script>

</body>

</html>